import java.time.*
Date now = new Date()

process {
    errorStrategy = 'finish'
    withName: trim {
        container = 'docker://staphb/trimmomatic:0.39'
    }
    withName: kraken {
        container = 'docker://staphb/kraken2:2.1.2-no-db'
        memory = '100 GB'
    }
    withName: filterreads {
        conda = 'bioconda::krakentools=1.2'
    }
    withName: kraken2krona {
        conda = 'bioconda::krakentools=1.2'
    }
    withName: krona {
        conda = 'bioconda::krona=2.8'
    }
    withName: ray {
        container = 'library://millironx/default/ray:v2.3.1'
        errorStrategy = 'ignore'
    }
    withName: iva {
        container = 'docker://sangerpathogens/iva:1.0.11'
        errorStrategy = 'ignore'
    }
    withName: metavelvet {
        container = 'https://depot.galaxyproject.org/singularity/metavelvet:1.2.02--pl5.22.0_2'
        errorStrategy = 'ignore'
    }
    withName: abyss {
        container = 'docker://bcgsc/abyss'
        errorStrategy = 'ignore'
    }
    withName: bwa {
        container = 'docker://staphb/bwa:0.7.17'
    }
    withName: sortsam {
        container = 'docker://staphb/samtools:1.12'
    }
    withName: blast {
        container = 'docker://ncbi/blast:2.11.0'
    }
}
singularity {
    enabled = true
}
params {
    dev            = false
    devinputs      = 2
    help           = false
    kmerLength     = 35
    outfolder      = ""
    readsfolder    = "."
    runname        = "viral-metagenomics"
    threads        = 4
    tracedir       = '.trace'
    timestamp      = now.format('yyyyMMdd-HH-mm-ss')
    trimAdapters   = 'NexteraPE-PE.fa'
    trimMismatches = 2
    trimPclip      = 30
    trimClip       = 10
    trimWinsize    = 0
    trimWinqual    = 0
    trimLeading    = 0
    trimTrailing   = 0
    trimCrop       = 0
    trimHeadcrop   = 0
    trimMinlen     = 0
}
timeline {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_timeline.html"
}
report {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_report.html"
}
trace {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_trace.txt"
}
dag {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_dag.svg"
}
